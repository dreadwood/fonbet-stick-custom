"use strict";window.utils={BREAKPOINT_MOBILE:"(max-width: 767px)",BREAKPOINT_TABLET:"(max-width: 1023px)",toggleCssClass(t,e){if(!t)throw new Error("toggleCssClass: button not passed to parameters");if("string"!=typeof e)throw new Error("toggleCssClass: toggleClassName is not passed or is not a string");t.classList.toggle(e),t.blur()},toggleCssClassNodes(t,e,s){if(!t)throw new Error("toggleCssClassNodes: button not passed to parameters");if("string"!=typeof e||"string"!=typeof s)throw new Error("toggleCssClassNodes: nodeClassName or toggleClassName are not passed or is not a string");const i=document.querySelectorAll(`.${e}`);if(0===i.length)throw new Error(`toggleCssClassNodes: nodes with class ${e} do not exist`);i.forEach((t=>t.classList.toggle(s))),t.blur()},toggleVisibleNodes(t,e){if(!t)throw new Error("toggleVisibleNodes: button not passed to parameters");if("string"!=typeof e)throw new Error("toggleVisibleNodes: nodeClassName is not passed or is not a string");const s=document.querySelectorAll(`.${e}`);if(0===s.length)throw new Error(`toggleVisibleNodes: nodes with class ${e} do not exist`);s.forEach((t=>{t.hasAttribute("hidden")?t.removeAttribute("hidden"):t.setAttribute("hidden","hidden")})),t.blur()},fetchData:async(t,e)=>await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},(()=>{var t=!1,e=setInterval((function(){void 0!==window.registrationApi&&(t=!0),t&&(clearInterval(e),document.dispatchEvent(new Event("registrationInit")),registrationApi.onRegistrationStateChanged=function(t){console.log("registrationApi state",t)},registrationApi.onRegistrationCompleted=function(t){document.dispatchEvent(new CustomEvent("registrationCompleted",{detail:{clientId:t}})),console.log("Registration completed",t)})}),500);const s=(()=>{let t=null,e=null,s=null;const i=t=>{const e=document.cookie.match(new RegExp(`(?:^|; )${t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")}=([^;]*)`));return e?decodeURIComponent(e[1]):void 0},o=(t,e=window.location.href)=>{t=t.replace(/[\[\]]/g,"\\$&");const s=new RegExp(`[?&]${t}(=([^&#]*)|&|#|$)`).exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null},r=()=>{e=t,t=o("clientId")||i("headerApi.cid")||o("fsid")},n=()=>{s=i("headerApi.fsid")||i("headerApi.FSID")},c=()=>{if("visible"===document.visibilityState){r();const s=new CustomEvent("userInfoUpdated",{detail:{clientId:t,prevClientId:e}});document.dispatchEvent(s)}};return r(),n(),document.addEventListener("visibilitychange",c),{getClientID:()=>t,getPrevClientID:()=>e,setClientID:r,getFSID:()=>s,setFSID:n,handleVisibilityChange:c}})();window.userInfo=s})(),(()=>{const t=["red","white","black","carbon"],e=document.querySelector(".js-result-end-container"),s=e.querySelector(".js-set-result-stick"),i=e.querySelector(".js-set-result-pattern"),o=e.querySelector(".js-set-result-blade"),r=e.querySelector(".js-set-result-name");window.result=e=>{const n=e.color_stick===t[0]||e.color_stick===t[1]?"black":"white";if(s.src=`./img/sticks/stick-empty-${e.color_stick}.webp`,"0"===e.shaft_texture)i.setAttribute("hidden","hidden");else{const t=e.shaft_color||"black";i.src=`./img/sticks/pattern-${t}-${e.shaft_texture}.webp`,i.removeAttribute("hidden")}const c=e.color_hook,l=e.hook_cover;o.src=`./img/sticks/blade-${c}-${l}.webp`,r.textContent=e.text,r.style=`color: ${n};`}})(),(()=>{const t=document.querySelector(".js-loading"),e=document.querySelector(".js-start"),s=document.querySelector(".js-set"),i=document.querySelector(".js-result-end"),o=document.querySelector(".js-auth-overlay"),r=document.querySelector(".js-start-btn"),n=document.querySelector(".js-auth-close");if(!(t&&e&&s&&r&&o&&n))return;const c=()=>{t.setAttribute("hidden","hidden"),e.removeAttribute("hidden")},l=t=>{"Escape"===t.key&&d()},d=()=>{o.classList.remove("show"),document.removeEventListener("keydown",l)},a=()=>{e.setAttribute("hidden","hidden"),s.removeAttribute("hidden")};document.addEventListener("userInfoUpdated",(t=>{console.log("User info updated:",t.detail),console.log("Previous Client ID:",t.detail.prevClientId),console.log("Current Client ID:",t.detail.clientId),t.detail.clientId!==t.detail.prevClientId&&(d(),a())})),document.addEventListener("registrationCompleted",(function(t){t.detail.clientId&&(d(),a())})),r.addEventListener("click",(()=>{window.userInfo.getClientID()?a():(o.classList.add("show"),document.addEventListener("keydown",l))})),n.addEventListener("click",(()=>d())),o.addEventListener("click",(t=>{t.target===o&&d()})),(async()=>{const e=window.userInfo.getClientID();if(e){const s={pin:e};console.log(s);try{const e=await window.utils.fetchData("https://xcomfeed.com/fonbet/great8/get-stick",s);if(200===e.status){const s=await e.json();window.result(s.data),t.setAttribute("hidden","hidden"),i.removeAttribute("hidden"),console.log(s.data)}else c()}catch(t){console.error(t),c()}}else c()})()})(),(()=>{const t={1:"first",2:"second",3:"third",4:"fourth",5:"fifth",6:"finish"},e={1:"Цвет",2:"Шафт",3:"Покрытие крюка",4:"Персонализация",5:"Технические характеристики"},s={red:"красный",white:"белый",black:"черный",carbon:"карбон"},i={matte:"матовое",normal:"обычное",glossy:"глянцевое",glitter:"Зернистое"},o=["red","white","black","carbon"],r=["red","white","black","chrome","reflective"],n=[0,1,2,3,4,5,6],c=["normal","glossy","matte","glitter"],l=Object.values(t);({step:1,stickColor:o[0],stickPatternColor:0,stickPatternType:0,stickBladeColor:0,stickBladeTexture:0,stickName:"",stickNameColor:"black",stickFormGrip:"right",stickFormFlex:"90",stepEl:null,titleEl:null,setBtnPrev:null,setBtnNext:null,setBtnSave:null,setBtnReturn:null,init(){document.querySelector(".js-set")&&(this.stepEl=document.querySelector(".js-set-step"),this.titleEl=document.querySelector(".js-set-title"),this.setBtnPrev=document.querySelector(".js-set-btn-prev"),this.setBtnNext=document.querySelector(".js-set-btn-next"),this.setBtnSave=document.querySelector(".js-set-btn-save"),this.setBtnReturn=document.querySelector(".js-set-btn-return"),this.setBtnPrev.addEventListener("click",(()=>this.prevStep())),this.setBtnNext.addEventListener("click",(()=>this.nextStep())),this.setBtnSave.addEventListener("click",(()=>this.saveResult())),this.initWindowFirst(),this.initWindowSecond(),this.initWindowThird(),this.initWindowFourth(),this.initWindowFifth(),this.initModalBet(),this.initModalScore())},prevStep(){this.step=this.step-1,this.showBackground(),this.updateSetBtnsNavigation(),this.updateScreen()},nextStep(){this.step=this.step+1,this.showBackground(),this.updateSetBtnsNavigation(),this.updateScreen()},showBackground(){this.changeVisibility(".js-bg")},updateScreen(){this.stepEl.textContent=this.step,this.titleEl.textContent=e[this.step],this.changeCssClass(".js-set-content"),this.changeCssClass(".js-set-wrp"),this.changeCssClass(".js-set-left"),this.changeVisibility(".js-set-visibility"),6===this.step&&(this.updateWindowResult(),this.setBtnSave.removeAttribute("hidden"),this.setBtnReturn.setAttribute("hidden","hidden"))},updateSetBtnsNavigation(){1!==this.step?this.setBtnPrev.removeAttribute("hidden"):this.setBtnPrev.setAttribute("hidden","hidden"),6===this.step?this.setBtnNext.setAttribute("disabled","disabled"):this.setBtnNext.removeAttribute("disabled"),this.changeCssClass(".js-set-btn-prev"),this.changeCssClass(".js-set-btn-next"),this.changeCssClass(".js-set-btn-save")},initWindowFirst(){const t=document.querySelector(".js-widow.first"),e=document.querySelector(".js-widow.second"),i=document.querySelector(".js-widow.fourth"),r=t.querySelector(".js-widow-btn.prev"),n=t.querySelector(".js-widow-btn.next"),c=t.querySelector(".js-widow-img"),l=e.querySelector(".js-widow-img"),d=i.querySelector(".js-widow-img"),a=t.querySelector(".js-widow-pag-list"),u=document.querySelector(".js-widow-color-stick-name"),h=i.querySelector(".js-window-name-label"),m=()=>{const t=o.findIndex((t=>t===this.stickColor));0===t?(r.setAttribute("disabled","disabled"),n.removeAttribute("disabled")):t+1===o.length?(r.removeAttribute("disabled"),n.setAttribute("disabled","disabled")):(r.removeAttribute("disabled"),n.removeAttribute("disabled")),c.src=`./img/sticks/stick-${this.stickColor}.webp`,l.src=`./img/sticks/shaft-${this.stickColor}.webp`,d.src=`./img/sticks/end-${this.stickColor}.webp`,u.textContent=s[this.stickColor],this.stickNameColor=this.stickColor===o[0]||this.stickColor===o[1]?"black":"white",h.style=`color: ${this.stickNameColor};`};a.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickColor=t.target.dataset.color,m())})),r.addEventListener("click",(()=>{const t=o.findIndex((t=>t===this.stickColor)),e=o[t-1];this.stickColor=e,m()})),n.addEventListener("click",(()=>{const t=o.findIndex((t=>t===this.stickColor)),e=o[t+1];this.stickColor=e,m()}))},initWindowSecond(){const t=document.querySelector(".js-widow.second"),e=t.querySelector(".js-widow-btn.prev"),s=t.querySelector(".js-widow-btn.next"),i=t.querySelector(".js-widow-pattern"),o=t.querySelector(".js-widow-pag-list"),c=t.querySelector(".js-widow-color-list"),l=()=>{if(0===this.stickPatternType?(e.setAttribute("disabled","disabled"),s.removeAttribute("disabled")):this.stickPatternType+1===n.length?(e.removeAttribute("disabled"),s.setAttribute("disabled","disabled")):(e.removeAttribute("disabled"),s.removeAttribute("disabled")),0===this.stickPatternType)i.setAttribute("hidden","hidden");else{const t=r[this.stickPatternColor];i.src=`./img/sticks/pattern-${t}-${this.stickPatternType}.webp`,i.removeAttribute("hidden")}};c.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickPatternColor=t.target.dataset.color,l())})),o.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickPatternType=+t.target.dataset.pattern,l())})),e.addEventListener("click",(()=>{this.stickPatternType=this.stickPatternType-1,l()})),s.addEventListener("click",(()=>{this.stickPatternType=this.stickPatternType+1,l()}))},initWindowThird(){const t=document.querySelector(".js-widow.third"),e=t.querySelector(".js-widow-btn.prev"),s=t.querySelector(".js-widow-btn.next"),r=t.querySelector(".js-widow-img"),n=t.querySelector(".js-widow-color-list"),l=t.querySelector(".js-widow-pag-list"),d=document.querySelector(".js-widow-blade-texture"),a=document.querySelector(".js-widow-pag-text"),u=l.querySelectorAll("button"),h=()=>{0===this.stickBladeTexture?(e.setAttribute("disabled","disabled"),s.removeAttribute("disabled")):this.stickBladeTexture+1===c.length?(e.removeAttribute("disabled"),s.setAttribute("disabled","disabled")):(e.removeAttribute("disabled"),s.removeAttribute("disabled")),u.forEach(((t,e)=>{e===this.stickBladeTexture?t.classList.add("actv"):t.classList.remove("actv")}));const t=o[this.stickBladeColor],n=c[this.stickBladeTexture];d.textContent=i[c[this.stickBladeTexture]],a.textContent=`Покрытие крюка ${this.stickBladeTexture+1}/4`,r.src=`./img/sticks/blade-${t}-${n}.webp`};n.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickBladeColor=t.target.dataset.color,h())})),l.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickBladeTexture=+t.target.dataset.texture,h())})),e.addEventListener("click",(()=>{this.stickBladeTexture=this.stickBladeTexture-1,h()})),s.addEventListener("click",(()=>{this.stickBladeTexture=this.stickBladeTexture+1,h()}))},initWindowFourth(){const t=document.querySelector(".js-widow.fourth").querySelector(".js-window-name-label");document.querySelector(".js-window-name-input").addEventListener("input",(e=>{const s=e.target.value.slice(0,14);e.target.value=s,t.textContent=s,this.stickName=s}))},initWindowFifth(){const t=document.querySelector(".js-spec");t.addEventListener("change",(()=>{this.stickFormGrip=t.elements.grip.value,this.stickFormFlex=+t.elements.flex.value}))},initModalBet(){const t=document.querySelector(".js-bet"),e=t.querySelector(".js-bet-btn"),s=document.querySelector(".js-score");e.addEventListener("click",(()=>{t.classList.remove("show"),s.classList.add("show")}))},initModalScore(){const t=document.querySelector(".js-score");document.querySelector(".js-score-close").addEventListener("click",(()=>{t.classList.remove("show")})),t.addEventListener("click",(e=>{e.target===t&&t.classList.remove("show")}))},updateWindowResult(){const t=document.querySelector(".js-set-result"),e=t.querySelector(".js-set-result-stick"),s=t.querySelector(".js-set-result-pattern"),i=t.querySelector(".js-set-result-blade"),n=t.querySelector(".js-set-result-name");if(e.src=`./img/sticks/stick-empty-${this.stickColor}.webp`,0===this.stickPatternType)s.setAttribute("hidden","hidden");else{const t=r[this.stickPatternColor];s.src=`./img/sticks/pattern-${t}-${this.stickPatternType}.webp`,s.removeAttribute("hidden")}const l=o[this.stickBladeColor],d=c[this.stickBladeTexture];i.src=`./img/sticks/blade-${l}-${d}.webp`,n.textContent=this.stickName,n.style=`color: ${this.stickNameColor};`},async renderStick(){const t=document.querySelector(".js-set-result-field"),e=document.querySelector(".js-set-result-name");e.classList.add("print");try{const s=await html2canvas(t,{backgroundColor:null});console.log(s);const i=document.createElement("a");i.href=s.toDataURL("image/png"),i.download="result.png",i.click(),e.classList.remove("print")}catch(t){console.error(t)}},async saveResult(){const t=window.userInfo.getClientID(),e=document.querySelector(".js-bet");this.hideEl(this.setBtnPrev),this.hideEl(this.setBtnSave),this.showEl(this.setBtnReturn);try{await this.renderStick();const s={pin:t,color_stick:this.stickColor,shaft_texture:this.stickPatternType,shaft_color:r[this.stickPatternColor],color_hook:o[this.stickBladeColor],hook_cover:c[this.stickBladeTexture],text:this.stickName,grip:this.stickFormGrip,flex:this.stickFormFlex,deflection_point:""},i=await window.utils.fetchData("https://xcomfeed.com/fonbet/great8/stick-send",s);console.log(e),i.ok&&(console.log("test"),e.classList.add("show"),this.showEl(this.setBtnReturn))}catch(t){console.error(t)}},showEl(t){t.removeAttribute("hidden")},hideEl(t){t.setAttribute("hidden","hidden")},changeVisibility(e){document.querySelectorAll(e).forEach((e=>{e.classList.contains(t[this.step])?e.removeAttribute("hidden"):e.setAttribute("hidden","hidden")}))},changeCssClass(e){const s=document.querySelector(e);l.forEach((e=>{e!==t[this.step]?s.classList.remove(e):s.classList.add(e)}))}}).init()})();