"use strict";window.const={clientId:null,END_DATE:"14.12.2024",STICK_SEND_URL:"https://xcomfeed.com/fonbet/great8/stick-send",GET_STICK_URL:"https://xcomfeed.com/fonbet/great8/get-stick",STEPS:{1:"first",2:"second",3:"third",4:"fourth",5:"fifth",6:"finish"},TITLES:{1:"Цвет",2:"Шафт",3:"Покрытие крюка",4:"Персонализация",5:"Технические характеристики"},COLORS:{red:"красный",white:"белый",black:"черный",carbon:"карбон"},TEXTURE:{matte:"матовое",normal:"обычное",glossy:"глянцевое",glitter:"Зернистое"},STICK_COLOR:["red","white","black","carbon"],STICK_PATTERN_COLOR:["red","white","black","chrome","reflective"],STICK_PATTERN_TYPE:[0,1,2,3,4,5,6],BLADE_TEXTURE:["normal","glossy","matte","glitter"]},window.utils={fetchData:async(t,e)=>await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),showEl(t){t.removeAttribute("hidden")},hideEl(t){t.setAttribute("hidden","hidden")},showModal(t){t.classList.add("show"),document.body.classList.add("scroll-lock")},closeModal(t){t.classList.remove("show"),document.body.classList.remove("scroll-lock")}},(()=>{let t=!1,e=setInterval((()=>{void 0!==window.registrationApi&&(t=!0),t&&(clearInterval(e),document.dispatchEvent(new Event("registrationInit")),registrationApi.onRegistrationStateChanged=t=>{console.log("registrationApi state",t)},registrationApi.onRegistrationCompleted=t=>{document.dispatchEvent(new CustomEvent("registrationCompleted",{detail:{clientId:t}})),console.log("Registration completed",t)})}),500);const i=(()=>{let t=null,e=null,i=null;const s=t=>{const e=document.cookie.match(new RegExp(`(?:^|; )${t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")}=([^;]*)`));return e?decodeURIComponent(e[1]):void 0},o=(t,e=window.location.href)=>{t=t.replace(/[\[\]]/g,"\\$&");const i=new RegExp(`[?&]${t}(=([^&#]*)|&|#|$)`).exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},n=()=>{e=t,t=o("clientId")||s("headerApi.cid")||o("fsid")},l=()=>{i=s("headerApi.fsid")||s("headerApi.FSID")},d=()=>{if("visible"===document.visibilityState){n();const i=new CustomEvent("userInfoUpdated",{detail:{clientId:t,prevClientId:e}});document.dispatchEvent(i)}};return n(),l(),document.addEventListener("visibilitychange",d),{getClientID:()=>t,getPrevClientID:()=>e,setClientID:n,getFSID:()=>i,setFSID:l,handleVisibilityChange:d}})();window.userInfo=i})(),window.modal={initAuth(t){const e=t.querySelector(".js-modal-auth-btn-close"),i=t=>{"Escape"===t.key&&s()},s=()=>{window.utils.closeModal(t),document.removeEventListener("keydown",i)};return e.addEventListener("click",(()=>s())),t.addEventListener("click",(e=>{e.target===t&&s()})),[()=>{window.utils.showModal(t),document.addEventListener("keydown",i)},s]},initBet(t,e){t.querySelector(".js-modal-bet-btn").addEventListener("click",(()=>{window.utils.closeModal(t),window.utils.showModal(e)}))},initShare(t,e){const i=t.querySelector(".js-modal-share-btn-close"),s=t.querySelector(".js-modal-share-btn-share"),o=t.querySelector(".js-modal-share-btn-site"),n=()=>{window.utils.closeModal(t),window.utils.showModal(e)};s.addEventListener("click",(()=>n())),o.addEventListener("click",(()=>n())),i.addEventListener("click",(()=>n())),t.addEventListener("click",(e=>{e.target===t&&n()}))},initScore(t){t.querySelector(".js-modal-score-btn-close").addEventListener("click",(()=>window.utils.closeModal(t))),t.addEventListener("click",(e=>{e.target===t&&window.utils.closeModal(t)}))}},(()=>{const t=document.querySelector(".js-result-end-container"),e=t.querySelectorAll(".js-result-stick"),i=t.querySelectorAll(".js-result-pattern"),s=t.querySelectorAll(".js-result-blade"),o=t.querySelector(".js-result-name-text");window.result=t=>{const n=t.color_stick===window.const.STICK_COLOR[0]||t.color_stick===window.const.STICK_COLOR[1]?"black":"white";if(e.forEach((e=>{e.classList.contains(t.color_stick)?window.utils.showEl(e):window.utils.hideEl(e)})),"0"===t.shaft_texture)i.forEach((t=>window.utils.hideEl(t)));else{const e=`${t.shaft_color||"red"}-${t.shaft_texture}`;i.forEach((t=>{t.classList.contains(e)?window.utils.showEl(t):window.utils.hideEl(t)}))}const l=`${t.color_hook}-${t.hook_cover}`;s.forEach((t=>{t.classList.contains(l)?window.utils.showEl(t):window.utils.hideEl(t)})),o.textContent=t.text,o.style=`color: ${n};`}})(),(()=>{const t=document.querySelector(".js-loading"),e=document.querySelector(".js-start"),i=document.querySelector(".js-set"),s=document.querySelector(".js-result-end"),o=document.querySelector(".js-modal-auth"),n=document.querySelector(".js-start-btn");if(!(t&&e&&i&&n&&o))return;const[l,d]=window.modal.initAuth(o),r=()=>{window.utils.hideEl(t),window.utils.showEl(e)},c=()=>{window.utils.hideEl(e),window.utils.hideEl(t),window.utils.showEl(s)},a=()=>{window.utils.hideEl(e),window.utils.showEl(i)};document.addEventListener("userInfoUpdated",(t=>{console.log("User info updated:",t.detail),console.log("Previous Client ID:",t.detail.prevClientId),console.log("Current Client ID:",t.detail.clientId),t.detail.clientId!==t.detail.prevClientId&&(d(),a())})),document.addEventListener("registrationCompleted",(async t=>{const e=t.detail.clientId;if(e){window.utils.clientId=e;const t={pin:e};try{const e=await window.utils.fetchData(window.const.GET_STICK_URL,t);if(200===e.status){const t=await e.json();window.result(t.data),c(),d()}else d(),a()}catch(t){console.error(t),d(),a()}}})),n.addEventListener("click",(()=>{window.userInfo.getClientID()?a():l()})),(async()=>{const t=window.userInfo.getClientID();if(t){const e={pin:t};try{const t=await window.utils.fetchData(window.const.GET_STICK_URL,e);if(200===t.status){const e=await t.json();window.result(e.data),c()}else r()}catch(t){console.error(t),r()}}else r()})()})(),(()=>{const t=Object.values(window.const.STEPS);({step:1,stickColor:window.const.STICK_COLOR[0],stickPatternColor:0,stickPatternType:0,stickBladeColor:0,stickBladeTexture:0,stickName:"",stickNameColor:"black",stickFormGrip:"right",stickFormFlex:"90",stepEl:null,titleEl:null,setBtnPrev:null,setBtnNext:null,setBtnSave:null,setBtnReturn:null,modalBet:null,modalShare:null,modalScore:null,windowFirst:null,windowSecond:null,windowThird:null,windowFourth:null,init(){document.querySelector(".js-set")&&(this.stepEl=document.querySelector(".js-set-step"),this.titleEl=document.querySelector(".js-set-title"),this.setBtnPrev=document.querySelector(".js-set-btn-prev"),this.setBtnNext=document.querySelector(".js-set-btn-next"),this.setBtnSave=document.querySelector(".js-set-btn-save"),this.setBtnReturn=document.querySelector(".js-set-btn-return"),this.modalBet=document.querySelector(".js-modal-bet"),this.modalShare=document.querySelector(".js-modal-share"),this.modalScore=document.querySelector(".js-modal-score"),this.windowFirst=document.querySelector(".js-widow.first"),this.windowSecond=document.querySelector(".js-widow.second"),this.windowThird=document.querySelector(".js-widow.third"),this.windowFourth=document.querySelector(".js-widow.fourth"),this.setBtnPrev.addEventListener("click",(()=>this.prevStep())),this.setBtnNext.addEventListener("click",(()=>this.nextStep())),this.setBtnSave.addEventListener("click",(()=>this.saveResult())),this.initWindowFirst(),this.initWindowSecond(),this.initWindowThird(),this.initWindowFourth(),this.initWindowFifth(),window.modal.initBet(this.modalBet,this.modalShare),window.modal.initShare(this.modalShare,this.modalScore),window.modal.initScore(this.modalScore))},prevStep(){this.step=this.step-1,this.showBackground(),this.updateSetBtnsNavigation(),this.updateScreen()},nextStep(){this.step=this.step+1,this.showBackground(),this.updateSetBtnsNavigation(),this.updateScreen()},showBackground(){this.changeVisibility(".js-bg")},updateScreen(){this.stepEl.textContent=this.step,this.titleEl.textContent=window.const.TITLES[this.step],this.changeCssClass(".js-set-content"),this.changeCssClass(".js-set-wrp"),this.changeCssClass(".js-set-left"),this.changeVisibility(".js-set-visibility"),6===this.step&&(this.updateWindowResult(),window.utils.showEl(this.setBtnSave),window.utils.hideEl(this.setBtnReturn))},updateSetBtnsNavigation(){1!==this.step?window.utils.showEl(this.setBtnPrev):window.utils.hideEl(this.setBtnPrev),5===this.step&&(window.utils.hideEl(this.setBtnSave),window.utils.showEl(this.setBtnNext)),6===this.step&&window.utils.hideEl(this.setBtnNext),this.changeCssClass(".js-set-btn-prev"),this.changeCssClass(".js-set-btn-next"),this.changeCssClass(".js-set-btn-save")},updateWindow(){const t=this.windowFirst.querySelectorAll(".js-widow-img"),e=this.windowSecond.querySelectorAll(".js-widow-img"),i=this.windowSecond.querySelectorAll(".js-widow-pattern"),s=this.windowThird.querySelectorAll(".js-widow-blade"),o=this.windowFourth.querySelectorAll(".js-widow-name-stick"),n=this.windowFourth.querySelector(".js-window-name-label"),l=document.querySelector(".js-widow-color-stick-name"),d=document.querySelector(".js-widow-blade-texture-name");if(t.forEach((t=>{t.classList.contains(this.stickColor)?window.utils.showEl(t):window.utils.hideEl(t)})),l.textContent=window.const.COLORS[this.stickColor],e.forEach((t=>{t.classList.contains(this.stickColor)?window.utils.showEl(t):window.utils.hideEl(t)})),0===this.stickPatternType)i.forEach((t=>window.utils.hideEl(t)));else{const t=`${window.const.STICK_PATTERN_COLOR[this.stickPatternColor]}-${this.stickPatternType}`;i.forEach((e=>{e.classList.contains(t)?window.utils.showEl(e):window.utils.hideEl(e)}))}const r=window.const.STICK_COLOR[this.stickBladeColor],c=window.const.BLADE_TEXTURE[this.stickBladeTexture],a=`${r}-${c}`;s.forEach((t=>{t.classList.contains(a)?window.utils.showEl(t):window.utils.hideEl(t)})),d.textContent=window.const.TEXTURE[c],o.forEach((t=>{t.classList.contains(this.stickColor)?window.utils.showEl(t):window.utils.hideEl(t)})),this.stickNameColor=this.stickColor===window.const.STICK_COLOR[0]||this.stickColor===window.const.STICK_COLOR[1]?"black":"white",n.style=`color: ${this.stickNameColor};`},initWindowFirst(){const t=this.windowFirst.querySelector(".js-widow-btn.prev"),e=this.windowFirst.querySelector(".js-widow-btn.next"),i=this.windowFirst.querySelector(".js-widow-pag-list"),s=()=>{const i=window.const.STICK_COLOR.findIndex((t=>t===this.stickColor));0===i?(t.setAttribute("disabled","disabled"),e.removeAttribute("disabled")):i+1===window.const.STICK_COLOR.length?(t.removeAttribute("disabled"),e.setAttribute("disabled","disabled")):(t.removeAttribute("disabled"),e.removeAttribute("disabled")),this.updateWindow()};i.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickColor=t.target.dataset.color,s())})),t.addEventListener("click",(()=>{const t=window.const.STICK_COLOR.findIndex((t=>t===this.stickColor)),e=window.const.STICK_COLOR[t-1];this.stickColor=e,s()})),e.addEventListener("click",(()=>{const t=window.const.STICK_COLOR.findIndex((t=>t===this.stickColor)),e=window.const.STICK_COLOR[t+1];this.stickColor=e,s()}))},initWindowSecond(){const t=this.windowSecond.querySelector(".js-widow-btn.prev"),e=this.windowSecond.querySelector(".js-widow-btn.next"),i=this.windowSecond.querySelector(".js-widow-pag-list"),s=this.windowSecond.querySelector(".js-widow-color-list"),o=i.querySelectorAll("button"),n=()=>{0===this.stickPatternType?(t.setAttribute("disabled","disabled"),e.removeAttribute("disabled")):this.stickPatternType+1===window.const.STICK_PATTERN_TYPE.length?(t.removeAttribute("disabled"),e.setAttribute("disabled","disabled")):(t.removeAttribute("disabled"),e.removeAttribute("disabled")),o.forEach(((t,e)=>{e===this.stickPatternType?t.classList.add("actv"):t.classList.remove("actv")})),this.updateWindow()};s.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickPatternColor=t.target.dataset.color,n())})),i.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickPatternType=+t.target.dataset.pattern,n())})),t.addEventListener("click",(()=>{this.stickPatternType=this.stickPatternType-1,n()})),e.addEventListener("click",(()=>{this.stickPatternType=this.stickPatternType+1,n()}))},initWindowThird(){const t=this.windowThird.querySelector(".js-widow-btn.prev"),e=this.windowThird.querySelector(".js-widow-btn.next"),i=this.windowThird.querySelector(".js-widow-color-list"),s=this.windowThird.querySelector(".js-widow-pag-list"),o=document.querySelector(".js-widow-pag-text"),n=s.querySelectorAll("button"),l=()=>{0===this.stickBladeTexture?(t.setAttribute("disabled","disabled"),e.removeAttribute("disabled")):this.stickBladeTexture+1===window.const.BLADE_TEXTURE.length?(t.removeAttribute("disabled"),e.setAttribute("disabled","disabled")):(t.removeAttribute("disabled"),e.removeAttribute("disabled")),n.forEach(((t,e)=>{e===this.stickBladeTexture?t.classList.add("actv"):t.classList.remove("actv")})),o.textContent=`Покрытие крюка ${this.stickBladeTexture+1}/4`,this.updateWindow()};i.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickBladeColor=t.target.dataset.color,l())})),s.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickBladeTexture=+t.target.dataset.texture,l())})),t.addEventListener("click",(()=>{this.stickBladeTexture=this.stickBladeTexture-1,l()})),e.addEventListener("click",(()=>{this.stickBladeTexture=this.stickBladeTexture+1,l()}))},initWindowFourth(){const t=this.windowFourth.querySelector(".js-window-name-label");document.querySelector(".js-window-name-input").addEventListener("input",(e=>{const i=e.target.value.slice(0,14);e.target.value=i,t.textContent=i,this.stickName=i}))},initWindowFifth(){const t=document.querySelector(".js-spec");t.addEventListener("change",(()=>{this.stickFormGrip=t.elements.grip.value,this.stickFormFlex=+t.elements.flex.value}))},updateWindowResult(){const t=document.querySelector(".js-result"),e=t.querySelectorAll(".js-result-stick"),i=t.querySelectorAll(".js-result-pattern"),s=t.querySelectorAll(".js-result-blade"),o=t.querySelector(".js-result-name-text");if(e.forEach((t=>{t.classList.contains(this.stickColor)?window.utils.showEl(t):window.utils.hideEl(t)})),0===this.stickPatternType)i.forEach((t=>window.utils.hideEl(t)));else{const t=`${window.const.STICK_PATTERN_COLOR[this.stickPatternColor]}-${this.stickPatternType}`;i.forEach((e=>{e.classList.contains(t)?window.utils.showEl(e):window.utils.hideEl(e)}))}const n=`${window.const.STICK_COLOR[this.stickBladeColor]}-${window.const.BLADE_TEXTURE[this.stickBladeTexture]}`;s.forEach((t=>{t.classList.contains(n)?window.utils.showEl(t):window.utils.hideEl(t)})),o.textContent=this.stickName,o.style=`color: ${this.stickNameColor};`},async renderStick(){const t=document.querySelector(".js-result-field"),e=document.querySelector(".js-result-name-text");e.classList.add("print");try{const i=await html2canvas(t,{backgroundColor:null}),s=document.createElement("a");s.href=i.toDataURL("image/png"),s.download="result.png",s.click(),e.classList.remove("print")}catch(t){console.error(t)}},async saveResult(){const t=window.userInfo.getClientID();window.utils.hideEl(this.setBtnPrev),window.utils.hideEl(this.setBtnSave),window.utils.showEl(this.setBtnReturn);const e={pin:t||window.const.clientId,color_stick:this.stickColor,shaft_texture:this.stickPatternType,shaft_color:window.const.STICK_PATTERN_COLOR[this.stickPatternColor],color_hook:window.const.STICK_COLOR[this.stickBladeColor],hook_cover:window.const.BLADE_TEXTURE[this.stickBladeTexture],text:this.stickName,grip:this.stickFormGrip,flex:this.stickFormFlex,deflection_point:""};try{(await window.utils.fetchData(window.const.STICK_SEND_URL,e)).ok&&(window.utils.showModal(this.modalBet),window.utils.showEl(this.setBtnReturn))}catch(t){console.error(t)}try{this.renderStick()}catch(t){console.error(t)}this.updateResuteScreenContent()},updateResuteScreenContent(){const t=document.querySelector(".js-result-title-text"),e=document.querySelector(".js-result-msg-text");t.textContent="Твой дизайн",e.textContent=`Отличный результат! Совсем скоро мы подведем итоги и объявим победителей, которые выиграют Верную подругу Великой погони! Жди результатов ${window.const.END_DATE}.`},changeVisibility(t){document.querySelectorAll(t).forEach((t=>{t.classList.contains(window.const.STEPS[this.step])?window.utils.showEl(t):window.utils.hideEl(t)}))},changeCssClass(e){const i=document.querySelector(e);t.forEach((t=>{t!==window.const.STEPS[this.step]?i.classList.remove(t):i.classList.add(t)}))}}).init()})();