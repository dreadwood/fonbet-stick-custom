"use strict";window.const={clientId:null,END_DATE:"14.12.2024",STICK_SEND_URL:"https://xcomfeed.com/fonbet/great8/stick-send",GET_STICK_URL:"https://xcomfeed.com/fonbet/great8/get-stick",STEPS:{1:"first",2:"second",3:"third",4:"fourth",5:"fifth",6:"finish"},TITLES:{1:"Цвет",2:"Шафт",3:"Покрытие крюка",4:"Персонализация",5:"Технические характеристики"},COLORS:{red:"красный",white:"белый",black:"черный",carbon:"карбон"},TEXTURE:{matte:"матовое",normal:"обычное",glossy:"глянцевое",glitter:"Зернистое"},STICK_COLOR:["red","white","black","carbon"],STICK_PATTERN_COLOR:["red","white","black","chrome","reflective"],STICK_PATTERN_TYPE:[0,1,2,3,4,5,6],BLADE_TEXTURE:["normal","glossy","matte","glitter"]},window.utils={fetchData:async(t,e)=>await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),showEl(t){t.removeAttribute("hidden")},hideEl(t){t.setAttribute("hidden","hidden")},showModal(t){t.classList.add("show"),document.body.classList.add("scroll-lock")},closeModal(t){t.classList.remove("show"),document.body.classList.remove("scroll-lock")}},(()=>{let t=!1,e=setInterval((()=>{void 0!==window.registrationApi&&(t=!0),t&&(clearInterval(e),document.dispatchEvent(new Event("registrationInit")),registrationApi.onRegistrationStateChanged=t=>{console.log("registrationApi state",t)},registrationApi.onRegistrationCompleted=t=>{document.dispatchEvent(new CustomEvent("registrationCompleted",{detail:{clientId:t}})),console.log("Registration completed",t)})}),500);const s=(()=>{let t=null,e=null,s=null;const i=t=>{const e=document.cookie.match(new RegExp(`(?:^|; )${t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")}=([^;]*)`));return e?decodeURIComponent(e[1]):void 0},o=(t,e=window.location.href)=>{t=t.replace(/[\[\]]/g,"\\$&");const s=new RegExp(`[?&]${t}(=([^&#]*)|&|#|$)`).exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null},n=()=>{e=t,t=o("clientId")||i("headerApi.cid")||o("fsid")},r=()=>{s=i("headerApi.fsid")||i("headerApi.FSID")},l=()=>{if("visible"===document.visibilityState){n();const s=new CustomEvent("userInfoUpdated",{detail:{clientId:t,prevClientId:e}});document.dispatchEvent(s)}};return n(),r(),document.addEventListener("visibilitychange",l),{getClientID:()=>t,getPrevClientID:()=>e,setClientID:n,getFSID:()=>s,setFSID:r,handleVisibilityChange:l}})();window.userInfo=s})(),window.modal={initBet(t,e){t.querySelector(".js-modal-bet-btn").addEventListener("click",(()=>{window.utils.closeModal(t),window.utils.showModal(e)}))},initShare(t,e){const s=t.querySelector(".js-modal-share-btn-share"),i=t.querySelector(".js-modal-share-btn-site"),o=()=>{window.utils.closeModal(t),window.utils.showModal(e)};s.addEventListener("click",(()=>o())),i.addEventListener("click",(()=>o())),t.addEventListener("click",(e=>{e.target===t&&o()}))},initScore(t){t.querySelector(".js-score-btn-close").addEventListener("click",(()=>window.utils.closeModal(t))),t.addEventListener("click",(e=>{e.target===t&&window.utils.closeModal(t)}))}},(()=>{const t=document.querySelector(".js-result-end-container"),e=t.querySelector(".js-set-result-stick"),s=t.querySelector(".js-set-result-pattern"),i=t.querySelector(".js-set-result-blade"),o=t.querySelector(".js-set-result-name");window.result=t=>{const n=t.color_stick===window.const.STICK_COLOR[0]||t.color_stick===window.const.STICK_COLOR[1]?"black":"white";if(e.src=`./img/sticks/stick-empty-${t.color_stick}.webp`,"0"===t.shaft_texture)window.utils.hideEl(s);else{const e=t.shaft_color||"black";s.src=`./img/sticks/pattern-${e}-${t.shaft_texture}.webp`,window.utils.showEl(s)}const r=t.color_hook,l=t.hook_cover;i.src=`./img/sticks/blade-${r}-${l}.webp`,o.textContent=t.text,o.style=`color: ${n};`}})(),(()=>{const t=document.querySelector(".js-loading"),e=document.querySelector(".js-start"),s=document.querySelector(".js-set"),i=document.querySelector(".js-result-end"),o=document.querySelector(".js-modal-auth"),n=document.querySelector(".js-start-btn"),r=o.querySelector(".js-modal-auth-btn-close");if(!(t&&e&&s&&n&&o&&r))return;const l=()=>{window.utils.hideEl(t),window.utils.showEl(e)},c=()=>{window.utils.hideEl(e),window.utils.hideEl(t),window.utils.showEl(i)},d=t=>{"Escape"===t.key&&a()},a=()=>{window.utils.closeModal(o),document.removeEventListener("keydown",d)},w=()=>{window.utils.hideEl(e),window.utils.showEl(s)};document.addEventListener("userInfoUpdated",(t=>{console.log("User info updated:",t.detail),console.log("Previous Client ID:",t.detail.prevClientId),console.log("Current Client ID:",t.detail.clientId),t.detail.clientId!==t.detail.prevClientId&&(a(),w())})),document.addEventListener("registrationCompleted",(async t=>{const e=t.detail.clientId;if(e){window.utils.clientId=e;const t={pin:e};try{const e=await window.utils.fetchData(window.const.GET_STICK_URL,t);if(200===e.status){const t=await e.json();window.result(t.data),c(),a()}else a(),w()}catch(t){console.error(t),a(),w()}}})),n.addEventListener("click",(()=>{window.userInfo.getClientID()?w():(window.utils.showModal(o),document.addEventListener("keydown",d))})),r.addEventListener("click",(()=>a())),o.addEventListener("click",(t=>{t.target===o&&a()})),(async()=>{const t=window.userInfo.getClientID();if(t){const e={pin:t};try{const t=await window.utils.fetchData(window.const.GET_STICK_URL,e);if(200===t.status){const e=await t.json();window.result(e.data),c()}else l()}catch(t){console.error(t),l()}}else l()})()})(),(()=>{const t=Object.values(window.const.STEPS);({step:1,stickColor:window.const.STICK_COLOR[0],stickPatternColor:0,stickPatternType:0,stickBladeColor:0,stickBladeTexture:0,stickName:"",stickNameColor:"black",stickFormGrip:"right",stickFormFlex:"90",stepEl:null,titleEl:null,setBtnPrev:null,setBtnNext:null,setBtnSave:null,setBtnReturn:null,modalBet:null,modalShare:null,modalScore:null,init(){document.querySelector(".js-set")&&(this.stepEl=document.querySelector(".js-set-step"),this.titleEl=document.querySelector(".js-set-title"),this.setBtnPrev=document.querySelector(".js-set-btn-prev"),this.setBtnNext=document.querySelector(".js-set-btn-next"),this.setBtnSave=document.querySelector(".js-set-btn-save"),this.setBtnReturn=document.querySelector(".js-set-btn-return"),this.modalBet=document.querySelector(".js-modal-bet"),this.modalShare=document.querySelector(".js-modal-share"),this.modalScore=document.querySelector(".js-modal-score"),this.setBtnPrev.addEventListener("click",(()=>this.prevStep())),this.setBtnNext.addEventListener("click",(()=>this.nextStep())),this.setBtnSave.addEventListener("click",(()=>this.saveResult())),this.initWindowFirst(),this.initWindowSecond(),this.initWindowThird(),this.initWindowFourth(),this.initWindowFifth(),window.modal.initBet(this.modalBet,this.modalShare),window.modal.initShare(this.modalShare,this.modalScore),window.modal.initScore(this.modalScore))},prevStep(){this.step=this.step-1,this.showBackground(),this.updateSetBtnsNavigation(),this.updateScreen()},nextStep(){this.step=this.step+1,this.showBackground(),this.updateSetBtnsNavigation(),this.updateScreen()},showBackground(){this.changeVisibility(".js-bg")},updateScreen(){this.stepEl.textContent=this.step,this.titleEl.textContent=window.const.TITLES[this.step],this.changeCssClass(".js-set-content"),this.changeCssClass(".js-set-wrp"),this.changeCssClass(".js-set-left"),this.changeVisibility(".js-set-visibility"),6===this.step&&(this.updateWindowResult(),window.utils.showEl(this.setBtnSave),window.utils.hideEl(this.setBtnReturn))},updateSetBtnsNavigation(){1!==this.step?window.utils.showEl(this.setBtnPrev):window.utils.hideEl(this.setBtnPrev),5===this.step&&(window.utils.hideEl(this.setBtnSave),window.utils.showEl(this.setBtnNext)),6===this.step&&window.utils.hideEl(this.setBtnNext),this.changeCssClass(".js-set-btn-prev"),this.changeCssClass(".js-set-btn-next"),this.changeCssClass(".js-set-btn-save")},initWindowFirst(){const t=document.querySelector(".js-widow.first"),e=document.querySelector(".js-widow.second"),s=document.querySelector(".js-widow.fourth"),i=t.querySelector(".js-widow-btn.prev"),o=t.querySelector(".js-widow-btn.next"),n=t.querySelector(".js-widow-img"),r=e.querySelector(".js-widow-img"),l=s.querySelector(".js-widow-img"),c=t.querySelector(".js-widow-pag-list"),d=document.querySelector(".js-widow-color-stick-name"),a=s.querySelector(".js-window-name-label"),w=()=>{const t=window.const.STICK_COLOR.findIndex((t=>t===this.stickColor));0===t?(i.setAttribute("disabled","disabled"),o.removeAttribute("disabled")):t+1===window.const.STICK_COLOR.length?(i.removeAttribute("disabled"),o.setAttribute("disabled","disabled")):(i.removeAttribute("disabled"),o.removeAttribute("disabled")),n.src=`./img/sticks/stick-${this.stickColor}.webp`,r.src=`./img/sticks/shaft-${this.stickColor}.webp`,l.src=`./img/sticks/end-${this.stickColor}.webp`,d.textContent=window.const.COLORS[this.stickColor],this.stickNameColor=this.stickColor===window.const.STICK_COLOR[0]||this.stickColor===window.const.STICK_COLOR[1]?"black":"white",a.style=`color: ${this.stickNameColor};`};c.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickColor=t.target.dataset.color,w())})),i.addEventListener("click",(()=>{const t=window.const.STICK_COLOR.findIndex((t=>t===this.stickColor)),e=window.const.STICK_COLOR[t-1];this.stickColor=e,w()})),o.addEventListener("click",(()=>{const t=window.const.STICK_COLOR.findIndex((t=>t===this.stickColor)),e=window.const.STICK_COLOR[t+1];this.stickColor=e,w()}))},initWindowSecond(){const t=document.querySelector(".js-widow.second"),e=t.querySelector(".js-widow-btn.prev"),s=t.querySelector(".js-widow-btn.next"),i=t.querySelector(".js-widow-pattern"),o=t.querySelector(".js-widow-pag-list"),n=t.querySelector(".js-widow-color-list"),r=o.querySelectorAll("button"),l=()=>{if(0===this.stickPatternType?(e.setAttribute("disabled","disabled"),s.removeAttribute("disabled")):this.stickPatternType+1===window.const.STICK_PATTERN_TYPE.length?(e.removeAttribute("disabled"),s.setAttribute("disabled","disabled")):(e.removeAttribute("disabled"),s.removeAttribute("disabled")),r.forEach(((t,e)=>{e===this.stickPatternType?t.classList.add("actv"):t.classList.remove("actv")})),0===this.stickPatternType)window.utils.hideEl(i);else{const t=window.const.STICK_PATTERN_COLOR[this.stickPatternColor];i.src=`./img/sticks/pattern-${t}-${this.stickPatternType}.webp`,window.utils.showEl(i)}};n.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickPatternColor=t.target.dataset.color,l())})),o.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickPatternType=+t.target.dataset.pattern,l())})),e.addEventListener("click",(()=>{this.stickPatternType=this.stickPatternType-1,l()})),s.addEventListener("click",(()=>{this.stickPatternType=this.stickPatternType+1,l()}))},initWindowThird(){const t=document.querySelector(".js-widow.third"),e=t.querySelector(".js-widow-btn.prev"),s=t.querySelector(".js-widow-btn.next"),i=t.querySelector(".js-widow-img"),o=t.querySelector(".js-widow-color-list"),n=t.querySelector(".js-widow-pag-list"),r=document.querySelector(".js-widow-blade-texture"),l=document.querySelector(".js-widow-pag-text"),c=n.querySelectorAll("button"),d=()=>{0===this.stickBladeTexture?(e.setAttribute("disabled","disabled"),s.removeAttribute("disabled")):this.stickBladeTexture+1===window.const.BLADE_TEXTURE.length?(e.removeAttribute("disabled"),s.setAttribute("disabled","disabled")):(e.removeAttribute("disabled"),s.removeAttribute("disabled")),c.forEach(((t,e)=>{e===this.stickBladeTexture?t.classList.add("actv"):t.classList.remove("actv")}));const t=window.const.STICK_COLOR[this.stickBladeColor],o=window.const.BLADE_TEXTURE[this.stickBladeTexture];r.textContent=window.const.TEXTURE[o],l.textContent=`Покрытие крюка ${this.stickBladeTexture+1}/4`,i.src=`./img/sticks/blade-${t}-${o}.webp`};o.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickBladeColor=t.target.dataset.color,d())})),n.addEventListener("click",(t=>{"BUTTON"===t.target.tagName&&(this.stickBladeTexture=+t.target.dataset.texture,d())})),e.addEventListener("click",(()=>{this.stickBladeTexture=this.stickBladeTexture-1,d()})),s.addEventListener("click",(()=>{this.stickBladeTexture=this.stickBladeTexture+1,d()}))},initWindowFourth(){const t=document.querySelector(".js-widow.fourth").querySelector(".js-window-name-label");document.querySelector(".js-window-name-input").addEventListener("input",(e=>{const s=e.target.value.slice(0,14);e.target.value=s,t.textContent=s,this.stickName=s}))},initWindowFifth(){const t=document.querySelector(".js-spec");t.addEventListener("change",(()=>{this.stickFormGrip=t.elements.grip.value,this.stickFormFlex=+t.elements.flex.value}))},updateWindowResult(){const t=document.querySelector(".js-set-result"),e=t.querySelector(".js-set-result-stick"),s=t.querySelector(".js-set-result-pattern"),i=t.querySelector(".js-set-result-blade"),o=t.querySelector(".js-set-result-name");if(e.src=`./img/sticks/stick-empty-${this.stickColor}.webp`,0===this.stickPatternType)window.utils.hideEl(s);else{const t=window.const.STICK_PATTERN_COLOR[this.stickPatternColor];s.src=`./img/sticks/pattern-${t}-${this.stickPatternType}.webp`,window.utils.showEl(s)}const n=window.const.STICK_COLOR[this.stickBladeColor],r=window.const.BLADE_TEXTURE[this.stickBladeTexture];i.src=`./img/sticks/blade-${n}-${r}.webp`,o.textContent=this.stickName,o.style=`color: ${this.stickNameColor};`},async renderStick(){const t=document.querySelector(".js-set-result-field"),e=document.querySelector(".js-set-result-name");e.classList.add("print");try{const s=await html2canvas(t,{backgroundColor:null}),i=document.createElement("a");i.href=s.toDataURL("image/png"),i.download="result.png",i.click(),e.classList.remove("print")}catch(t){console.error(t)}},async saveResult(){const t=window.userInfo.getClientID();window.utils.hideEl(this.setBtnPrev),window.utils.hideEl(this.setBtnSave),window.utils.showEl(this.setBtnReturn);const e={pin:t||window.const.clientId,color_stick:this.stickColor,shaft_texture:this.stickPatternType,shaft_color:window.const.STICK_PATTERN_COLOR[this.stickPatternColor],color_hook:window.const.STICK_COLOR[this.stickBladeColor],hook_cover:window.const.BLADE_TEXTURE[this.stickBladeTexture],text:this.stickName,grip:this.stickFormGrip,flex:this.stickFormFlex,deflection_point:""};try{(await window.utils.fetchData(window.const.STICK_SEND_URL,e)).ok&&(window.utils.showModal(this.modalBet),window.utils.showEl(this.setBtnReturn))}catch(t){console.error(t)}try{this.renderStick()}catch(t){console.error(t)}this.updateResuteScreenContent()},updateResuteScreenContent(){const t=document.querySelector(".js-set-result-title"),e=document.querySelector(".js-set-result-text");t.textContent="Твой дизайн",e.textContent=`Отличный результат! Совсем скоро мы подведем итоги и объявим победителей, которые выиграют Верную подругу Великой погони! Жди результатов ${window.const.END_DATE}.`},changeVisibility(t){document.querySelectorAll(t).forEach((t=>{t.classList.contains(window.const.STEPS[this.step])?window.utils.showEl(t):window.utils.hideEl(t)}))},changeCssClass(e){const s=document.querySelector(e);t.forEach((t=>{t!==window.const.STEPS[this.step]?s.classList.remove(t):s.classList.add(t)}))}}).init()})();